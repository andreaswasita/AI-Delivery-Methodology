<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Project Effort Estimator - AI Delivery Methodology</title>
    <meta name="description" content="Convert project scope into effort estimates using story points, complexity factors, and historical data">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .calculator-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .wizard-section {
            background: white;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .wizard-section h2 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .info-card {
            background: #e7f3ff;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .input-section, .results-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group small {
            display: block;
            color: #666;
            margin-top: 0.25rem;
            font-size: 0.875rem;
        }

        .slider-container {
            margin-top: 0.5rem;
        }

        .slider-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 5px;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .calculate-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .result-subtext {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .phase-breakdown {
            margin-top: 2rem;
        }

        .phase-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .phase-name {
            font-weight: 600;
            color: #333;
        }

        .phase-hours {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1rem;
        }

        .phase-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .phase-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .team-composition {
            margin-top: 2rem;
        }

        .role-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .role-item:last-child {
            border-bottom: none;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .export-btn {
            flex: 1;
            padding: 0.75rem;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #667eea;
            color: white;
        }

        @media (max-width: 968px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>‚è±Ô∏è AI Project Effort Estimator</h1>
            <p class="subtitle">Convert project scope into accurate effort estimates</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <a href="index.html">‚Üê Back to Calculators</a>
        </div>
    </nav>

    <div class="calculator-container">
        <!-- Quick Start Wizard -->
        <div class="wizard-section" id="wizardSection">
            <h2>üöÄ Quick Start - Auto-Populate Estimate</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Answer 3 questions and we'll auto-populate your effort estimate</p>
            
            <div class="input-group">
                <label for="aiUseCase">1. What type of AI project? (Use Case)</label>
                <select id="aiUseCase" onchange="autoPopulateFromUseCase()">
                    <option value="">-- Select AI Use Case --</option>
                    <optgroup label="ü§ñ Conversational AI">
                        <option value="chatbot-basic">Customer Service Chatbot (Basic)</option>
                        <option value="chatbot-advanced">AI Assistant (Advanced with RAG)</option>
                        <option value="voice-assistant">Voice Assistant / IVR</option>
                    </optgroup>
                    <optgroup label="üìÑ Document AI">
                        <option value="doc-extraction">Document Data Extraction (Forms, Invoices)</option>
                        <option value="doc-classification">Document Classification & Routing</option>
                        <option value="doc-search">Intelligent Document Search</option>
                    </optgroup>
                    <optgroup label="üìä Predictive Analytics">
                        <option value="churn-prediction">Customer Churn Prediction</option>
                        <option value="demand-forecast">Demand Forecasting</option>
                        <option value="fraud-detection">Fraud Detection</option>
                        <option value="recommendation">Recommendation Engine</option>
                    </optgroup>
                    <optgroup label="üëÅÔ∏è Computer Vision">
                        <option value="image-classification">Image Classification</option>
                        <option value="object-detection">Object Detection</option>
                        <option value="quality-inspection">Quality Inspection / Defect Detection</option>
                    </optgroup>
                    <optgroup label="üìù Language AI">
                        <option value="sentiment-analysis">Sentiment Analysis</option>
                        <option value="content-moderation">Content Moderation</option>
                        <option value="text-summarization">Text Summarization</option>
                    </optgroup>
                    <optgroup label="üè¢ Enterprise AI">
                        <option value="process-automation">Process Automation with AI</option>
                        <option value="analytics-dashboard">AI-Powered Analytics Dashboard</option>
                        <option value="custom">Custom AI Solution</option>
                    </optgroup>
                </select>
                <small id="useCaseDescription">Select a use case to see description and typical features</small>
            </div>

            <div class="input-group">
                <label for="aiMaturity">2. What's your AI Maturity Level?</label>
                <select id="aiMaturity" onchange="autoPopulateFromUseCase()">
                    <option value="">-- Select Maturity Level --</option>
                    <option value="1">Level 1 - Initial / Aware (First AI project, limited experience)</option>
                    <option value="2">Level 2 - Developing / Experimenting (Some pilots, learning)</option>
                    <option value="3">Level 3 - Defined / Emerging (Established practices, some production AI)</option>
                    <option value="4">Level 4 - Managed / Performing (Mature AI delivery, multiple production systems)</option>
                    <option value="5">Level 5 - Optimizing / Leading (Industry-leading AI capability)</option>
                </select>
                <small id="maturityImpact">Maturity affects team velocity, risk level, and complexity handling</small>
            </div>

            <div class="input-group">
                <label for="industry">3. What's your industry?</label>
                <select id="industry" onchange="autoPopulateFromUseCase()">
                    <option value="">-- Select Industry --</option>
                    <option value="financial">Financial Services (Banking, Insurance)</option>
                    <option value="healthcare">Healthcare & Life Sciences</option>
                    <option value="retail">Retail & E-commerce</option>
                    <option value="manufacturing">Manufacturing</option>
                    <option value="technology">Technology & Software</option>
                    <option value="telecom">Telecommunications</option>
                    <option value="energy">Energy & Utilities</option>
                    <option value="government">Government & Public Sector</option>
                    <option value="other">Other</option>
                </select>
                <small id="industryImpact">Industry affects compliance requirements and typical complexity</small>
            </div>

            <div class="input-group">
                <label for="techStack">4. What's your primary technology stack?</label>
                <select id="techStack" onchange="autoPopulateFromUseCase()">
                    <option value="">-- Select Technology Stack --</option>
                    <option value="microsoft-lowcode">Microsoft Low-Code (Copilot Studio, Power Platform) ‚ö°</option>
                    <option value="microsoft-procode">Microsoft Pro-Code (Azure AI, Azure ML, OpenAI)</option>
                    <option value="microsoft-hybrid">Microsoft Hybrid (Mix of Low-Code + Pro-Code)</option>
                    <option value="opensource">Open Source (Python, TensorFlow, PyTorch, etc.)</option>
                    <option value="other-cloud">Other Cloud (AWS, GCP)</option>
                    <option value="custom">Custom / On-Premise</option>
                </select>
                <small id="techStackImpact">Technology choice significantly affects development speed</small>
            </div>

            <div class="input-group">
                <label for="projectName">Project Name (Optional)</label>
                <input type="text" id="projectName" placeholder="e.g., CBA CEBA Bot">
                <small>Give your project a name for the report</small>
            </div>

            <button class="calculate-btn" onclick="generateDetailedEstimate()" style="margin-top: 1rem;">
                ‚ú® Generate Detailed Estimate
            </button>
        </div>

        <div class="calculator-grid" id="detailedSection" style="display: none;">
            <!-- Input Section -->
            <div class="input-section">
                <h2>üìã Project Details</h2>
                <button onclick="showWizard()" style="float: right; padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">‚Üê Back to Wizard</button>
                <div style="clear: both; margin-bottom: 1rem;"></div>

                <div class="info-card" style="background: #e7f3ff; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <strong id="selectedUseCaseDisplay">Selected: </strong>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #555;">
                        <span id="autoPopulatedDetails"></span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="journeyPhase">AI Delivery Journey Phase</label>
                    <select id="journeyPhase" onchange="updateFeatureEstimate()">
                        <option value="">-- Select Phase --</option>
                        <option value="discovery">Discovery & Planning (5-10 features)</option>
                        <option value="mvp">MVP / Proof of Concept (10-20 features)</option>
                        <option value="pilot">Pilot / Limited Release (20-40 features)</option>
                        <option value="production">Full Production (40-80 features)</option>
                        <option value="enterprise">Enterprise Scale (80-150 features)</option>
                        <option value="custom">Custom - I'll specify</option>
                    </select>
                    <small>Select the project phase to get feature estimate guidance</small>
                </div>

                <div class="input-group">
                    <label for="numFeatures">Number of Features/User Stories</label>
                    <input type="number" id="numFeatures" value="20" min="1" max="500" onchange="calculateStoryPoints()">
                    <small id="featureGuidance">Auto-populated based on use case and phase</small>
                </div>

                <div class="input-group">
                    <label for="complexity">Project Complexity</label>
                    <select id="complexity" onchange="calculateStoryPoints()">
                        <option value="low">Low - Reporting/Analytics, Simple UI</option>
                        <option value="medium" selected>Medium - Document Processing, Chatbots</option>
                        <option value="high">High - Predictive Models, Computer Vision</option>
                        <option value="veryHigh">Very High - Multi-Model AI, Real-time Systems</option>
                    </select>
                    <small>Auto-set based on use case; adjust if needed</small>
                </div>

                <div class="input-group">
                    <label for="avgStoryPoints">Average Story Points per Feature</label>
                    <input type="number" id="avgStoryPoints" value="5" min="1" max="21" readonly style="background: #f0f0f0;">
                    <small id="storyPointGuidance">Auto-calculated based on complexity</small>
                </div>

                <div class="input-group">
                    <label for="teamVelocity">Team Velocity (Story Points per Sprint)</label>
                    <input type="number" id="teamVelocity" value="25" min="1" max="100" readonly style="background: #f0f0f0;">
                    <small id="velocityGuidance">Auto-calculated based on team size and maturity</small>
                </div>

                <div class="input-group">
                    <label for="teamSize">Team Size (FTE)</label>
                    <input type="number" id="teamSize" value="5" min="1" max="50">
                    <small>Auto-populated based on project; adjust if needed</small>
                </div>

                <div class="input-group">
                    <label for="riskLevel">Risk Level</label>
                    <select id="riskLevel" onchange="updateRiskBuffer()">
                        <option value="4">Low Risk - Clear requirements (4%)</option>
                        <option value="7" selected>Medium Risk - Some unknowns (7%)</option>
                        <option value="15">High Risk - Many uncertainties (15%)</option>
                    </select>
                    <small>Auto-set based on maturity; adjust if needed</small>
                </div>

                <h3 style="margin-top: 2rem; margin-bottom: 1rem;">üìù Example User Stories</h3>
                <div id="userStoriesDisplay" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto; font-size: 0.9rem;">
                    <p style="color: #666;">User stories will appear here after selecting a use case</p>
                </div>

                <div class="input-group">
                    <label>
                        <input type="checkbox" id="includeDiscovery" checked>
                        Include Discovery Phase (15% of development effort)
                    </label>
                </div>

                <div class="input-group">
                    <label>
                        <input type="checkbox" id="includeDeployment" checked>
                        Include Deployment Phase (10% of development effort)
                    </label>
                </div>

                <div class="input-group">
                    <label>
                        <input type="checkbox" id="customAllocations" onchange="toggleAllocations()">
                        Customize Role Allocations (Part-Time)
                    </label>
                    <small>Adjust team member allocations (e.g., Product Owner at 50%, QA at 25% initially)</small>
                </div>

                <div id="allocationControls" style="display: none; background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="margin-top: 0; color: #333; font-size: 0.95rem;">Role Allocations (% FTE)</h4>
                    <small style="display: block; margin-bottom: 1rem; color: #666;">These apply to the team composition breakdown below</small>
                    
                    <div class="allocation-slider">
                        <div class="allocation-label">
                            <span>Product Manager</span>
                            <span class="allocation-value"><span id="pmAllocationValue">50</span>%</span>
                        </div>
                        <input type="range" min="10" max="100" value="50" step="5" class="slider" id="pmAllocation">
                    </div>

                    <div class="allocation-slider">
                        <div class="allocation-label">
                            <span>Architect / Tech Lead</span>
                            <span class="allocation-value"><span id="architectAllocationValue">100</span>%</span>
                        </div>
                        <input type="range" min="10" max="100" value="100" step="5" class="slider" id="architectAllocation">
                    </div>

                    <div class="allocation-slider">
                        <div class="allocation-label">
                            <span>ML Engineers / Developers</span>
                            <span class="allocation-value"><span id="mlAllocationValue">100</span>%</span>
                        </div>
                        <input type="range" min="10" max="100" value="100" step="5" class="slider" id="mlAllocation">
                    </div>

                    <div class="allocation-slider">
                        <div class="allocation-label">
                            <span>QA Engineers</span>
                            <span class="allocation-value"><span id="qaAllocationValue">25</span>%</span>
                        </div>
                        <input type="range" min="10" max="100" value="25" step="5" class="slider" id="qaAllocation">
                    </div>

                    <div class="allocation-slider">
                        <div class="allocation-label">
                            <span>DevOps Engineer</span>
                            <span class="allocation-value"><span id="devopsAllocationValue">50</span>%</span>
                        </div>
                        <input type="range" min="10" max="100" value="50" step="5" class="slider" id="devopsAllocation">
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateEffort()">üìä Calculate Effort</button>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <h2>Effort Estimate</h2>
                
                <div class="result-card">
                    <div class="result-label">Total Effort</div>
                    <div class="result-value" id="totalHours">-</div>
                    <div class="result-subtext" id="totalDays">Calculate to see results</div>
                </div>

                <div class="result-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="result-label">Timeline (with <span id="teamSizeDisplay">-</span> FTE)</div>
                    <div class="result-value" id="timeline">-</div>
                    <div class="result-subtext" id="timelineWeeks">-</div>
                </div>

                <div class="phase-breakdown" id="phaseBreakdown" style="display: none;">
                    <h3>Phase Breakdown</h3>
                    <!-- Phases will be inserted here by JavaScript -->
                </div>

                <div class="team-composition" id="teamComposition" style="display: none;">
                    <h3>Suggested Team Composition</h3>
                    <!-- Team roles will be inserted here by JavaScript -->
                </div>

                <div class="export-buttons" style="display: none;" id="exportButtons">
                    <button class="export-btn" onclick="exportToJSON()">üì• Export JSON</button>
                    <button class="export-btn" onclick="copyToClipboard()">üìã Copy Summary</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2026 AI Delivery Methodology | Part of Microsoft AI Frontier</p>
        </div>
    </footer>

    <script>
        // ============================================
        // USE CASE TEMPLATES WITH USER STORIES
        // ============================================
        const useCaseTemplates = {
            'chatbot-basic': {
                name: 'Customer Service Chatbot (Basic)',
                description: 'FAQ chatbot with basic intent recognition',
                complexity: 'medium',
                baseFeatures: 15,
                baseTeamSize: 4,
                userStories: [
                    'As a customer, I want to ask common questions and get instant answers',
                    'As a customer, I want the chatbot to understand my intent even with typos',
                    'As a customer, I want to escalate to a human agent when needed',
                    'As a customer, I want to access the chatbot 24/7 on website',
                    'As a business, I want to track chatbot usage and popular questions',
                    'As a business, I want to update FAQ content easily',
                    'As a business, I want to see conversation history',
                    'As a user, I want the chatbot to support multiple languages',
                    'As a user, I want the chatbot to remember context within a conversation',
                    'As a user, I want to rate chatbot responses',
                    'As an admin, I want to configure chatbot personality and tone',
                    'As an admin, I want to see analytics on chatbot performance',
                    'As an admin, I want to integrate with our CRM system',
                    'As a developer, I want to deploy chatbot to Teams/Slack',
                    'As a developer, I want to test chatbot before production'
                ]
            },
            'chatbot-advanced': {
                name: 'AI Assistant (Advanced with RAG)',
                description: 'Advanced AI assistant with RAG, custom knowledge base',
                complexity: 'high',
                baseFeatures: 30,
                baseTeamSize: 6,
                userStories: [
                    'As a user, I want to ask questions about company documents',
                    'As a user, I want the AI to cite sources for its answers',
                    'As a user, I want to upload documents for the AI to learn from',
                    'As a user, I want the AI to understand complex multi-turn conversations',
                    'As a user, I want personalized responses based on my role',
                    'As a business, I want to integrate multiple knowledge sources (SharePoint, wikis, etc)',
                    'As a business, I want to control what documents the AI can access',
                    'As a business, I want to ensure data privacy and security',
                    'As a business, I want to track AI accuracy and user satisfaction',
                    'As a business, I want to fine-tune the AI on our domain',
                    'As an admin, I want to manage user permissions',
                    'As an admin, I want to monitor AI costs and usage',
                    'As an admin, I want to configure retrieval strategies',
                    'As an admin, I want to version control knowledge base',
                    'As an admin, I want to audit AI responses for compliance'
                ]
            },
            'voice-assistant': {
                name: 'Voice Assistant / IVR',
                description: 'Voice-enabled AI for customer service and IVR systems',
                complexity: 'high',
                baseFeatures: 25,
                baseTeamSize: 6,
                userStories: [
                    'As a customer, I want to speak naturally to get help',
                    'As a customer, I want the system to understand different accents and speech patterns',
                    'As a customer, I want to interrupt and change topics mid-conversation',
                    'As a customer, I want confirmation before taking actions',
                    'As a customer, I want to transfer to a live agent anytime',
                    'As a business, I want to integrate with existing IVR infrastructure',
                    'As a business, I want to support multiple languages',
                    'As a business, I want to handle thousands of concurrent calls',
                    'As a business, I want to track call resolution rates',
                    'As a business, I want to reduce average handle time',
                    'As a business, I want to identify caller intent quickly',
                    'As a business, I want to authenticate callers securely',
                    'As a developer, I want to integrate with telephony systems',
                    'As a developer, I want to test voice interactions',
                    'As an admin, I want to monitor call quality and accuracy',
                    'As an admin, I want to update voice prompts and responses',
                    'As an admin, I want to analyze call transcripts',
                    'As a compliance officer, I want to ensure regulatory compliance for recorded calls'
                ]
            },
            'doc-classification': {
                name: 'Document Classification & Routing',
                description: 'Automatically classify and route documents',
                complexity: 'medium',
                baseFeatures: 18,
                baseTeamSize: 4,
                userStories: [
                    'As a user, I want to upload documents for automatic classification',
                    'As a user, I want to see classification confidence scores',
                    'As a user, I want to correct misclassifications',
                    'As a business, I want to classify 20-50 document types',
                    'As a business, I want to route documents to appropriate teams',
                    'As a business, I want to integrate with document management system',
                    'As a business, I want to handle multiple file formats',
                    'As a business, I want to track classification accuracy',
                    'As a business, I want to train on new document types',
                    'As a developer, I want to process documents in batches',
                    'As an admin, I want to configure routing rules',
                    'As an admin, I want to monitor processing queues'
                ]
            },
            'doc-search': {
                name: 'Intelligent Document Search',
                description: 'AI-powered semantic search across documents',
                complexity: 'medium',
                baseFeatures: 20,
                baseTeamSize: 5,
                userStories: [
                    'As a user, I want to search documents using natural language',
                    'As a user, I want to see relevant results even with synonyms',
                    'As a user, I want to filter by document type, date, author',
                    'As a user, I want to preview documents in search results',
                    'As a business, I want to search across multiple repositories',
                    'As a business, I want to respect document permissions',
                    'As a business, I want to track popular searches',
                    'As a business, I want to improve search over time',
                    'As a developer, I want to integrate with SharePoint, OneDrive',
                    'As an admin, I want to configure search relevance'
                ]
            },
            'demand-forecast': {
                name: 'Demand Forecasting',
                description: 'Predict future demand for products or services',
                complexity: 'high',
                baseFeatures: 28,
                baseTeamSize: 5,
                userStories: [
                    'As a business analyst, I want to see demand forecasts for next 30/60/90 days',
                    'As a business analyst, I want to compare forecast vs actual',
                    'As a business analyst, I want to understand forecast drivers',
                    'As a supply chain manager, I want to forecast by product, region, channel',
                    'As a supply chain manager, I want to incorporate seasonality',
                    'As a supply chain manager, I want to account for promotions and events',
                    'As a business, I want to integrate historical sales data',
                    'As a business, I want to include external factors (weather, economy)',
                    'As a business, I want to track forecast accuracy',
                    'As a business, I want to retrain models monthly',
                    'As a developer, I want to deploy forecasts to planning systems',
                    'As an admin, I want to configure forecast parameters'
                ]
            },
            'content-moderation': {
                name: 'Content Moderation',
                description: 'Automated moderation of user-generated content',
                complexity: 'high',
                baseFeatures: 22,
                baseTeamSize: 5,
                userStories: [
                    'As a platform, I want to detect inappropriate content automatically',
                    'As a platform, I want to flag content for human review',
                    'As a moderator, I want to review flagged content efficiently',
                    'As a moderator, I want to provide feedback to improve AI',
                    'As a business, I want to moderate text, images, videos',
                    'As a business, I want to detect multiple violation types',
                    'As a business, I want to handle real-time moderation',
                    'As a business, I want to track moderation accuracy',
                    'As a developer, I want to integrate with content platforms',
                    'As an admin, I want to configure moderation policies'
                ]
            },
            'text-summarization': {
                name: 'Text Summarization',
                description: 'Automatically summarize long documents',
                complexity: 'medium',
                baseFeatures: 16,
                baseTeamSize: 4,
                userStories: [
                    'As a user, I want to upload documents for summarization',
                    'As a user, I want to choose summary length (short/medium/long)',
                    'As a user, I want to highlight key points',
                    'As a business, I want to summarize multiple document types',
                    'As a business, I want to preserve important details',
                    'As a business, I want to batch summarize documents',
                    'As a business, I want to track summary quality',
                    'As a developer, I want to integrate with document systems',
                    'As an admin, I want to configure summary parameters'
                ]
            },
            'analytics-dashboard': {
                name: 'AI-Powered Analytics Dashboard',
                description: 'Interactive dashboard with AI insights',
                complexity: 'medium',
                baseFeatures: 22,
                baseTeamSize: 5,
                userStories: [
                    'As a business user, I want to ask questions about data in natural language',
                    'As a business user, I want AI to suggest insights automatically',
                    'As a business user, I want to drill down into anomalies',
                    'As a business user, I want to create custom visualizations',
                    'As a business, I want to connect to multiple data sources',
                    'As a business, I want to schedule automated reports',
                    'As a business, I want to share dashboards securely',
                    'As a developer, I want to integrate with Power BI/Tableau',
                    'As an admin, I want to manage data access permissions'
                ]
            },
            'custom': {
                name: 'Custom AI Solution',
                description: 'Custom AI project - will use defaults',
                complexity: 'medium',
                baseFeatures: 20,
                baseTeamSize: 5,
                userStories: [
                    'As a user, I want the AI solution to meet my specific needs',
                    'Custom user stories will be defined during discovery',
                    'Features will be prioritized based on business value',
                    'Solution will be tailored to industry requirements',
                    'Implementation will follow AI delivery methodology'
                ]
            },
            'doc-extraction': {
                name: 'Document Data Extraction',
                description: 'Extract structured data from forms, invoices, receipts',
                complexity: 'medium',
                baseFeatures: 20,
                baseTeamSize: 5,
                userStories: [
                    'As a user, I want to upload documents (PDF, images) for extraction',
                    'As a user, I want to see extracted data in structured format',
                    'As a user, I want to verify and correct extracted data',
                    'As a user, I want to export extracted data to Excel/CSV',
                    'As a business, I want to process multiple document types (invoices, receipts, forms)',
                    'As a business, I want to integrate with our ERP system',
                    'As a business, I want to track extraction accuracy',
                    'As a business, I want to handle documents in multiple languages',
                    'As a business, I want to train the model on our specific document formats',
                    'As a business, I want to batch process 1000s of documents',
                    'As a business, I want to detect and flag suspicious documents',
                    'As an admin, I want to configure extraction templates',
                    'As an admin, I want to monitor processing queue',
                    'As an admin, I want to see error reports and retry failed extractions',
                    'As a developer, I want APIs for programmatic document submission'
                ]
            },
            'churn-prediction': {
                name: 'Customer Churn Prediction',
                description: 'Predict which customers are likely to churn',
                complexity: 'high',
                baseFeatures: 25,
                baseTeamSize: 5,
                userStories: [
                    'As a business analyst, I want to see churn risk scores for all customers',
                    'As a business analyst, I want to understand why a customer is flagged as high risk',
                    'As a business analyst, I want to segment customers by churn risk',
                    'As a marketing manager, I want to create retention campaigns for high-risk customers',
                    'As a marketing manager, I want to see predicted churn for next 30/60/90 days',
                    'As a business, I want to track churn prediction accuracy over time',
                    'As a business, I want to integrate with CRM (Salesforce, Dynamics)',
                    'As a business, I want to retrain model monthly with new data',
                    'As a business, I want alerts when high-value customers are at risk',
                    'As a data scientist, I want to engineer features from customer behavior',
                    'As a data scientist, I want to experiment with different models',
                    'As a data scientist, I want to explain model predictions to business users',
                    'As a data engineer, I want to build data pipelines from multiple sources',
                    'As an admin, I want to monitor model performance metrics',
                    'As an admin, I want to schedule automated retraining'
                ]
            },
            'fraud-detection': {
                name: 'Fraud Detection',
                description: 'Real-time fraud detection for transactions',
                complexity: 'veryHigh',
                baseFeatures: 35,
                baseTeamSize: 7,
                userStories: [
                    'As a system, I want to score every transaction for fraud risk in <100ms',
                    'As a fraud analyst, I want to review flagged transactions',
                    'As a fraud analyst, I want to see why a transaction was flagged',
                    'As a fraud analyst, I want to mark transactions as fraud/not fraud for retraining',
                    'As a business, I want to reduce false positives (legitimate transactions blocked)',
                    'As a business, I want to catch fraud before transaction completes',
                    'As a business, I want to integrate with payment gateway',
                    'As a business, I want to track fraud detection accuracy and savings',
                    'As a business, I want to handle 10K+ transactions per second',
                    'As a business, I want to detect new fraud patterns automatically',
                    'As a data scientist, I want to use transaction history, device fingerprinting, behavioral patterns',
                    'As a data scientist, I want to experiment with ensemble models',
                    'As a developer, I want to deploy model with A/B testing',
                    'As a developer, I want monitoring and alerting for model performance',
                    'As a compliance officer, I want audit trails for all fraud decisions'
                ]
            },
            'recommendation': {
                name: 'Recommendation Engine',
                description: 'Personalized product/content recommendations',
                complexity: 'high',
                baseFeatures: 28,
                baseTeamSize: 6,
                userStories: [
                    'As a customer, I want to see personalized product recommendations',
                    'As a customer, I want recommendations based on my browsing history',
                    'As a customer, I want recommendations updated in real-time',
                    'As a business, I want to recommend products/content on homepage, product pages, checkout',
                    'As a business, I want to track recommendation click-through rate and conversion',
                    'As a business, I want to A/B test different recommendation strategies',
                    'As a business, I want to handle cold start (new users with no history)',
                    'As a business, I want to incorporate business rules (e.g., promote sale items)',
                    'As a business, I want to avoid recommending out-of-stock items',
                    'As a data scientist, I want to use collaborative filtering, content-based, hybrid approaches',
                    'As a data scientist, I want to experiment with deep learning models',
                    'As a data scientist, I want to explain why items were recommended',
                    'As a developer, I want to serve recommendations in <50ms',
                    'As a developer, I want to scale to millions of users',
                    'As an admin, I want to monitor recommendation quality metrics'
                ]
            },
            'image-classification': {
                name: 'Image Classification',
                description: 'Classify images into categories',
                complexity: 'high',
                baseFeatures: 22,
                baseTeamSize: 5,
                userStories: [
                    'As a user, I want to upload images for classification',
                    'As a user, I want to see classification results with confidence scores',
                    'As a user, I want to classify images in real-time (camera input)',
                    'As a business, I want to support 20-50 different categories',
                    'As a business, I want to handle various image formats and sizes',
                    'As a business, I want to batch process 1000s of images',
                    'As a business, I want to track classification accuracy',
                    'As a business, I want to train on our custom image dataset',
                    'As a data scientist, I want to use transfer learning (pre-trained models)',
                    'As a data scientist, I want to fine-tune model on our data',
                    'As a data scientist, I want to augment training data',
                    'As a data scientist, I want to explain model decisions (e.g., attention maps)',
                    'As a developer, I want to deploy model as REST API',
                    'As a developer, I want to optimize for inference speed',
                    'As an admin, I want to version control models'
                ]
            },
            'quality-inspection': {
                name: 'Quality Inspection / Defect Detection',
                description: 'Automated visual inspection for manufacturing',
                complexity: 'veryHigh',
                baseFeatures: 30,
                baseTeamSize: 6,
                userStories: [
                    'As a quality inspector, I want to scan products for defects automatically',
                    'As a quality inspector, I want to see defect type and location on image',
                    'As a quality inspector, I want to override AI decisions when wrong',
                    'As a business, I want to detect multiple defect types (scratches, dents, misalignment)',
                    'As a business, I want to achieve >99% accuracy (minimize false negatives)',
                    'As a business, I want to inspect products in real-time on production line',
                    'As a business, I want to track defect rates and trends',
                    'As a business, I want to integrate with manufacturing execution system',
                    'As a business, I want to handle different product variants',
                    'As a data scientist, I want to use object detection or segmentation models',
                    'As a data scientist, I want to train on limited defect examples (few-shot learning)',
                    'As a data scientist, I want to handle class imbalance (defects are rare)',
                    'As a developer, I want to deploy at edge (factory floor) for low latency',
                    'As a developer, I want to monitor model drift (product changes over time)',
                    'As an admin, I want to retrain model when new defect types appear'
                ]
            },
            'sentiment-analysis': {
                name: 'Sentiment Analysis',
                description: 'Analyze sentiment in customer feedback, social media',
                complexity: 'medium',
                baseFeatures: 18,
                baseTeamSize: 4,
                userStories: [
                    'As a business analyst, I want to see sentiment (positive/negative/neutral) for customer feedback',
                    'As a business analyst, I want to track sentiment trends over time',
                    'As a business analyst, I want to drill down into negative feedback',
                    'As a business, I want to analyze social media mentions',
                    'As a business, I want to analyze customer support tickets',
                    'As a business, I want to analyze product reviews',
                    'As a business, I want to get alerts when sentiment drops suddenly',
                    'As a business, I want to compare sentiment across products/services',
                    'As a business, I want to support multiple languages',
                    'As a data scientist, I want to classify sentiment with confidence scores',
                    'As a data scientist, I want to detect emotions (angry, happy, frustrated, etc.)',
                    'As a developer, I want to process real-time streams (Twitter, etc.)',
                    'As a developer, I want to integrate with customer feedback tools',
                    'As an admin, I want to configure sentiment thresholds for alerts'
                ]
            },
            'process-automation': {
                name: 'Process Automation with AI',
                description: 'Automate business processes using AI',
                complexity: 'high',
                baseFeatures: 25,
                baseTeamSize: 6,
                userStories: [
                    'As a business user, I want to trigger automation with natural language',
                    'As a business user, I want AI to make decisions in the process',
                    'As a business user, I want to review AI decisions before execution',
                    'As a business, I want to automate end-to-end workflows',
                    'As a business, I want to integrate with existing systems (ERP, CRM)',
                    'As a business, I want to track automation success rate',
                    'As a business, I want to handle exceptions (human-in-the-loop)',
                    'As a business, I want to measure time/cost savings from automation',
                    'As a business, I want to scale to 1000s of process instances per day',
                    'As a developer, I want to use workflow orchestration (Azure Logic Apps, Power Automate)',
                    'As a developer, I want to integrate multiple AI models (document extraction, classification, etc.)',
                    'As a developer, I want to monitor process performance',
                    'As an admin, I want to configure business rules',
                    'As an admin, I want audit trails for compliance'
                ]
            }
        };

        // ============================================
        // MATURITY LEVEL ADJUSTMENTS
        // ============================================
        const maturityAdjustments = {
            '1': { // Initial / Aware
                velocityMultiplier: 0.6,  // Lower velocity (learning)
                riskBuffer: 15,           // High risk
                teamSizeMultiplier: 1.2,  // Slightly larger team (inefficiency)
                description: 'First AI project; expect learning curve and slower velocity'
            },
            '2': { // Developing / Experimenting
                velocityMultiplier: 0.75,
                riskBuffer: 10,
                teamSizeMultiplier: 1.1,
                description: 'Some experience; still building practices'
            },
            '3': { // Defined / Emerging
                velocityMultiplier: 1.0,
                riskBuffer: 7,
                teamSizeMultiplier: 1.0,
                description: 'Established practices; typical velocity'
            },
            '4': { // Managed / Performing
                velocityMultiplier: 1.2,
                riskBuffer: 5,
                teamSizeMultiplier: 0.9,
                description: 'Mature delivery; higher velocity, smaller teams'
            },
            '5': { // Optimizing / Leading
                velocityMultiplier: 1.4,
                riskBuffer: 4,
                teamSizeMultiplier: 0.8,
                description: 'Industry-leading; very efficient'
            }
        };

        // ============================================
        // INDUSTRY ADJUSTMENTS
        // ============================================
        const industryAdjustments = {
            'financial': {
                complianceOverhead: 1.25,  // 25% more effort for compliance
                riskIncrease: 2,           // +2% risk buffer
                description: 'High compliance requirements (GDPR, financial regulations)'
            },
            'healthcare': {
                complianceOverhead: 1.3,   // 30% more effort
                riskIncrease: 3,
                description: 'Very high compliance (HIPAA, patient privacy)'
            },
            'retail': {
                complianceOverhead: 1.05,
                riskIncrease: 0,
                description: 'Moderate compliance; focus on scale'
            },
            'manufacturing': {
                complianceOverhead: 1.1,
                riskIncrease: 1,
                description: 'Quality and safety requirements'
            },
            'technology': {
                complianceOverhead: 1.0,
                riskIncrease: 0,
                description: 'Lower compliance; faster iteration'
            },
            'telecom': {
                complianceOverhead: 1.15,
                riskIncrease: 1,
                description: 'Regulatory oversight; scale requirements'
            },
            'energy': {
                complianceOverhead: 1.2,
                riskIncrease: 2,
                description: 'Safety-critical; regulatory compliance'
            },
            'government': {
                complianceOverhead: 1.35,
                riskIncrease: 3,
                description: 'High compliance; procurement complexity'
            },
            'other': {
                complianceOverhead: 1.1,
                riskIncrease: 1,
                description: 'Standard compliance requirements'
            }
        };

        // ============================================
        // TECHNOLOGY STACK ADJUSTMENTS
        // ============================================
        const techStackAdjustments = {
            'microsoft-lowcode': {
                effortMultiplier: 0.7,  // 30% faster with low-code (Copilot Studio, Power Platform)
                description: 'Low-code accelerates development significantly',
                bestFor: ['chatbot-basic', 'chatbot-advanced', 'voice-assistant', 'doc-extraction', 'process-automation'],
                velocityBoost: 1.3,  // Teams move 30% faster
                notes: 'Copilot Studio: 40-60% faster for chatbots; Power Platform: rapid prototyping'
            },
            'microsoft-procode': {
                effortMultiplier: 0.85,  // 15% faster with Azure AI services
                description: 'Azure AI services provide pre-built capabilities',
                bestFor: ['doc-extraction', 'image-classification', 'sentiment-analysis', 'fraud-detection'],
                velocityBoost: 1.15,
                notes: 'Azure OpenAI, Document Intelligence, Computer Vision reduce custom ML work'
            },
            'microsoft-hybrid': {
                effortMultiplier: 0.8,  // 20% faster with hybrid approach
                description: 'Best of both worlds - rapid prototyping + customization',
                bestFor: ['chatbot-advanced', 'process-automation', 'recommendation'],
                velocityBoost: 1.2,
                notes: 'Use low-code for UI/integration, pro-code for custom ML models'
            },
            'opensource': {
                effortMultiplier: 1.0,  // Baseline
                description: 'Maximum flexibility but more development effort',
                bestFor: ['custom', 'churn-prediction', 'recommendation'],
                velocityBoost: 1.0,
                notes: 'Full control but requires building more from scratch'
            },
            'other-cloud': {
                effortMultiplier: 0.9,  // 10% faster with other cloud services
                description: 'AWS/GCP AI services similar to Azure',
                bestFor: ['doc-extraction', 'image-classification', 'sentiment-analysis'],
                velocityBoost: 1.1,
                notes: 'AWS SageMaker, GCP Vertex AI comparable to Azure ML'
            },
            'custom': {
                effortMultiplier: 1.2,  // 20% more effort
                description: 'On-premise or custom infrastructure adds complexity',
                bestFor: [],
                velocityBoost: 0.9,
                notes: 'Infrastructure setup, security, scaling all manual'
            }
        };

        // ============================================
        // AUTO-POPULATE LOGIC
        // ============================================
        function autoPopulateFromUseCase() {
            const useCaseId = document.getElementById('aiUseCase').value;
            const maturityLevel = document.getElementById('aiMaturity').value;
            const industry = document.getElementById('industry').value;
            const techStack = document.getElementById('techStack').value;

            // Update descriptions as user selects
            if (useCaseId) {
                const useCase = useCaseTemplates[useCaseId];
                document.getElementById('useCaseDescription').textContent = useCase.description;
            }
            if (maturityLevel) {
                const maturity = maturityAdjustments[maturityLevel];
                document.getElementById('maturityImpact').textContent = maturity.description;
            }
            if (industry) {
                const ind = industryAdjustments[industry];
                document.getElementById('industryImpact').textContent = ind.description;
            }
            if (techStack) {
                const tech = techStackAdjustments[techStack];
                const savingsPercent = Math.round((1 - tech.effortMultiplier) * 100);
                const savingsText = tech.effortMultiplier < 1.0 
                    ? `${savingsPercent}% faster development` 
                    : tech.effortMultiplier > 1.0 
                        ? `${Math.round((tech.effortMultiplier - 1) * 100)}% more effort`
                        : 'Baseline effort';
                document.getElementById('techStackImpact').textContent = `${tech.description} (${savingsText})`;
            }

            if (!useCaseId || !maturityLevel || !industry || !techStack) {
                return;
            }

            // All four selected - show detailed section
            const useCase = useCaseTemplates[useCaseId];
            const maturity = maturityAdjustments[maturityLevel];
            const ind = industryAdjustments[industry];
            const tech = techStackAdjustments[techStack];

            // Check if tech stack is optimal for this use case
            const isOptimalTech = tech.bestFor.includes(useCaseId);
            const techBonus = isOptimalTech ? ' ‚ú® (Optimal for this use case!)' : '';

            // Update display
            document.getElementById('selectedUseCaseDisplay').textContent = 
                `Selected: ${useCase.name} | Maturity Level ${maturityLevel} | ${getIndustryName(industry)} | ${getTechStackName(techStack)}`;
            
            const effortReduction = Math.round((1 - tech.effortMultiplier) * 100);
            const effortText = tech.effortMultiplier < 1.0 
                ? `${effortReduction}% faster` 
                : tech.effortMultiplier > 1.0 
                    ? `${Math.round((tech.effortMultiplier - 1) * 100)}% slower`
                    : 'baseline';

            document.getElementById('autoPopulatedDetails').innerHTML = `
                <strong>üìä Auto-populated values:</strong><br>
                ‚Ä¢ Complexity: ${useCase.complexity}<br>
                ‚Ä¢ Base features: ${useCase.baseFeatures}<br>
                ‚Ä¢ Team size: ${Math.round(useCase.baseTeamSize * maturity.teamSizeMultiplier)} FTE<br>
                ‚Ä¢ Risk buffer: ${maturity.riskBuffer + ind.riskIncrease}%<br>
                ‚Ä¢ Compliance overhead: +${Math.round((ind.complianceOverhead - 1) * 100)}%<br>
                ‚Ä¢ Tech stack advantage: <strong style="color: #667eea;">${effortText}${techBonus}</strong><br>
                <small style="color: #666;">${tech.notes}</small>
            `;

            // Display user stories
            displayUserStories(useCase.userStories, useCase.baseFeatures);
        }

        function getIndustryName(industryCode) {
            const names = {
                'financial': 'Financial Services',
                'healthcare': 'Healthcare',
                'retail': 'Retail',
                'manufacturing': 'Manufacturing',
                'technology': 'Technology',
                'telecom': 'Telecommunications',
                'energy': 'Energy',
                'government': 'Government',
                'other': 'Other'
            };
            return names[industryCode] || industryCode;
        }

        function getTechStackName(techCode) {
            const names = {
                'microsoft-lowcode': 'Microsoft Low-Code (Copilot Studio)',
                'microsoft-procode': 'Microsoft Pro-Code (Azure AI)',
                'microsoft-hybrid': 'Microsoft Hybrid',
                'opensource': 'Open Source',
                'other-cloud': 'Other Cloud (AWS/GCP)',
                'custom': 'Custom / On-Premise'
            };
            return names[techCode] || techCode;
        }

        function displayUserStories(stories, totalFeatures) {
            const container = document.getElementById('userStoriesDisplay');
            
            // Show subset of stories if more than totalFeatures
            const storiesToShow = stories.slice(0, totalFeatures);
            const remaining = stories.length - storiesToShow.length;
            
            let html = '<strong>Example User Stories:</strong><ul style="margin: 0.5rem 0; padding-left: 1.5rem;">';
            storiesToShow.forEach(story => {
                html += `<li style="margin: 0.5rem 0;">${story}</li>`;
            });
            html += '</ul>';
            
            if (remaining > 0) {
                html += `<p style="color: #666; font-style: italic;">+ ${remaining} more user stories...</p>`;
            }
            
            html += `<p style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #ddd; color: #555;">
                <strong>Story Points Distribution:</strong> These user stories typically range from 2-13 story points based on complexity.
            </p>`;
            
            container.innerHTML = html;
        }

        function generateDetailedEstimate() {
            const useCaseId = document.getElementById('aiUseCase').value;
            const maturityLevel = document.getElementById('aiMaturity').value;
            const industry = document.getElementById('industry').value;
            const techStack = document.getElementById('techStack').value;

            console.log('Generating estimate:', { useCaseId, maturityLevel, industry, techStack });

            if (!useCaseId || !maturityLevel || !industry || !techStack) {
                alert('Please answer all 4 questions to generate an estimate');
                return;
            }

            const useCase = useCaseTemplates[useCaseId];
            const maturity = maturityAdjustments[maturityLevel];
            const ind = industryAdjustments[industry];
            const tech = techStackAdjustments[techStack];

            if (!useCase) {
                console.error('Use case template not found:', useCaseId);
                alert(`Error: Use case template "${useCaseId}" not found. Please try another use case or contact support.`);
                return;
            }

            console.log('Use case loaded:', useCase.name);

            // Store tech stack selection for use in calculation
            window.selectedTechStack = techStack;

            // Populate detailed inputs
            document.getElementById('journeyPhase').value = 'mvp';  // Default to MVP
            document.getElementById('numFeatures').value = useCase.baseFeatures;
            document.getElementById('complexity').value = useCase.complexity;
            
            // Adjust team size based on maturity
            const adjustedTeamSize = Math.round(useCase.baseTeamSize * maturity.teamSizeMultiplier);
            document.getElementById('teamSize').value = adjustedTeamSize;
            
            // Set risk level based on maturity and industry
            const totalRisk = maturity.riskBuffer + ind.riskIncrease;
            if (totalRisk <= 5) {
                document.getElementById('riskLevel').value = '4';
            } else if (totalRisk <= 10) {
                document.getElementById('riskLevel').value = '7';
            } else {
                document.getElementById('riskLevel').value = '15';
            }

            // Auto-populate project name if empty
            if (!document.getElementById('projectName').value) {
                document.getElementById('projectName').value = useCase.name;
            }

            // Recalculate story points with maturity adjustment
            calculateStoryPoints();

            // Show detailed section
            document.getElementById('wizardSection').style.display = 'none';
            document.getElementById('detailedSection').style.display = 'grid';

            // Auto-calculate
            setTimeout(() => {
                calculateEffort();
            }, 100);
        }

        function showWizard() {
            document.getElementById('wizardSection').style.display = 'block';
            document.getElementById('detailedSection').style.display = 'none';
        }

        // Industry guidance for story points based on complexity
        const storyPointGuidance = {
            low: { 
                avg: 3, 
                description: 'Low complexity: 2-5 story points per feature',
                velocityPerFTE: 8  // story points per sprint per FTE
            },
            medium: { 
                avg: 5, 
                description: 'Medium complexity: 3-8 story points per feature',
                velocityPerFTE: 6  // story points per sprint per FTE
            },
            high: { 
                avg: 8, 
                description: 'High complexity: 5-13 story points per feature',
                velocityPerFTE: 5  // story points per sprint per FTE
            },
            veryHigh: { 
                avg: 13, 
                description: 'Very high complexity: 8-21 story points per feature',
                velocityPerFTE: 4  // story points per sprint per FTE
            }
        };

        function toggleAllocations() {
            const checkbox = document.getElementById('customAllocations');
            const controls = document.getElementById('allocationControls');
            controls.style.display = checkbox.checked ? 'block' : 'none';
        }

        // Setup allocation sliders
        document.addEventListener('DOMContentLoaded', function() {
            const sliders = [
                { slider: 'pmAllocation', display: 'pmAllocationValue' },
                { slider: 'architectAllocation', display: 'architectAllocationValue' },
                { slider: 'mlAllocation', display: 'mlAllocationValue' },
                { slider: 'qaAllocation', display: 'qaAllocationValue' },
                { slider: 'devopsAllocation', display: 'devopsAllocationValue' }
            ];

            sliders.forEach(item => {
                const slider = document.getElementById(item.slider);
                const display = document.getElementById(item.display);
                if (slider && display) {
                    slider.addEventListener('input', function() {
                        display.textContent = this.value;
                    });
                }
            });
        });

        function calculateStoryPoints() {
            const complexity = document.getElementById('complexity').value;
            const teamSize = parseInt(document.getElementById('teamSize').value);
            const maturityLevel = document.getElementById('aiMaturity')?.value || '3';  // Default to Level 3
            const techStack = document.getElementById('techStack')?.value || 'opensource';  // Default to open source
            const guidance = storyPointGuidance[complexity];
            
            // Get maturity adjustment
            const maturity = maturityAdjustments[maturityLevel] || maturityAdjustments['3'];
            
            // Get tech stack adjustment
            const tech = techStackAdjustments[techStack] || techStackAdjustments['opensource'];
            
            // Update average story points
            document.getElementById('avgStoryPoints').value = guidance.avg;
            document.getElementById('storyPointGuidance').textContent = guidance.description;
            
            // Calculate team velocity based on team size, complexity, maturity, AND tech stack
            const baseVelocity = teamSize * guidance.velocityPerFTE;
            const maturityAdjustedVelocity = baseVelocity * maturity.velocityMultiplier;
            const finalVelocity = Math.round(maturityAdjustedVelocity * tech.velocityBoost);
            
            // Update velocity display
            document.getElementById('teamVelocity').value = finalVelocity;
            document.getElementById('velocityGuidance').textContent = 
                `Base: ${guidance.velocityPerFTE} points/FTE √ó ${teamSize} FTE √ó ${maturity.velocityMultiplier} (maturity) √ó ${tech.velocityBoost} (tech) = ${finalVelocity} points per sprint`;
        }

        function updateFeatureEstimate() {
            const phase = document.getElementById('journeyPhase').value;
            const numFeaturesInput = document.getElementById('numFeatures');
            const guidance = document.getElementById('featureGuidance');
            
            const featureRanges = {
                discovery: { min: 5, max: 10, avg: 7 },
                mvp: { min: 10, max: 20, avg: 15 },
                pilot: { min: 20, max: 40, avg: 30 },
                production: { min: 40, max: 80, avg: 60 },
                enterprise: { min: 80, max: 150, avg: 115 },
                custom: { avg: parseInt(numFeaturesInput.value) }
            };
            
            if (phase && phase !== 'custom') {
                const range = featureRanges[phase];
                numFeaturesInput.value = range.avg;
                guidance.textContent = `Typical range: ${range.min}-${range.max} features for this phase`;
                calculateStoryPoints();
            } else if (phase === 'custom') {
                guidance.textContent = 'Enter your custom feature count';
            }
        }

        function updateRiskBuffer() {
            const riskLevel = document.getElementById('riskLevel').value;
            // Risk levels are now in the select options: 4%, 7%, 15%
        }

        // Update velocity when team size changes
        document.getElementById('teamSize').addEventListener('input', calculateStoryPoints);

        function calculateEffort() {
            // Get inputs
            const projectName = document.getElementById('projectName').value || 'AI Project';
            const numFeatures = parseInt(document.getElementById('numFeatures').value);
            const complexity = document.getElementById('complexity').value;
            const avgStoryPoints = parseInt(document.getElementById('avgStoryPoints').value);
            const teamVelocity = parseInt(document.getElementById('teamVelocity').value);
            const teamSize = parseInt(document.getElementById('teamSize').value);
            const riskBuffer = parseInt(document.getElementById('riskLevel').value) / 100;
            const includeDiscovery = document.getElementById('includeDiscovery').checked;
            const includeDeployment = document.getElementById('includeDeployment').checked;

            // Get tech stack adjustment (if available from wizard)
            const techStack = document.getElementById('techStack')?.value || window.selectedTechStack || 'opensource';
            const tech = techStackAdjustments[techStack] || techStackAdjustments['opensource'];

            // Calculate total story points
            const totalStoryPoints = numFeatures * avgStoryPoints;
            
            // Industry standard: 6-8 productive hours per day, use 6.5 as average
            const productiveHoursPerDay = 6.5;
            const daysPerSprint = 10; // 2-week sprint
            const hoursPerSprint = productiveHoursPerDay * daysPerSprint;
            
            // Calculate hours per story point based on velocity
            // If team completes 'teamVelocity' points in a sprint with 'teamSize' people
            const hoursPerPoint = (teamSize * hoursPerSprint) / teamVelocity;
            
            // Calculate base development effort
            let baseHours = totalStoryPoints * hoursPerPoint;

            // Apply tech stack multiplier (THIS IS THE KEY CHANGE!)
            baseHours = baseHours * tech.effortMultiplier;
            
            // Complexity multipliers
            const complexityMultipliers = {
                low: 0.8,
                medium: 1.0,
                high: 1.3,
                veryHigh: 1.6
            };

            // Phase percentages (of base development hours)
            const phases = {
                development: { name: 'Development & Build', percentage: 1.0, hours: baseHours }
            };

            if (includeDiscovery) {
                phases.discovery = { name: 'Discovery & Planning', percentage: 0.15, hours: baseHours * 0.15 };
            }

            phases.testing = { name: 'Testing & QA', percentage: 0.25, hours: baseHours * 0.25 };

            if (includeDeployment) {
                phases.deployment = { name: 'Deployment & Handover', percentage: 0.10, hours: baseHours * 0.10 };
            }

            // Calculate subtotal
            let subtotal = Object.values(phases).reduce((sum, phase) => sum + phase.hours, 0);

            // Add risk buffer
            const bufferHours = subtotal * riskBuffer;
            const totalHours = subtotal + bufferHours;

            // Calculate timeline
            const workingHoursPerDay = 6; // Productive hours per day
            const totalDays = totalHours / (teamSize * workingHoursPerDay);
            const totalWeeks = totalDays / 5;
            const totalMonths = totalWeeks / 4;
            
            // Calculate number of sprints
            const numSprints = Math.ceil(totalStoryPoints / teamVelocity);

            // Display results
            document.getElementById('totalHours').textContent = Math.round(totalHours).toLocaleString() + ' hrs';
            document.getElementById('totalDays').textContent = `${Math.round(totalDays)} working days | ${numSprints} sprints (2 weeks each)`;
            
            document.getElementById('teamSizeDisplay').textContent = teamSize;
            
            if (totalMonths >= 1) {
                document.getElementById('timeline').textContent = totalMonths.toFixed(1) + ' months';
            } else {
                document.getElementById('timeline').textContent = Math.round(totalWeeks) + ' weeks';
            }
            document.getElementById('timelineWeeks').textContent = `${Math.round(totalWeeks)} weeks | ${numSprints} sprints`;

            // Display phase breakdown
            const phaseBreakdownDiv = document.getElementById('phaseBreakdown');
            phaseBreakdownDiv.style.display = 'block';
            phaseBreakdownDiv.innerHTML = '<h3>Phase Breakdown</h3>';

            const phaseOrder = ['discovery', 'development', 'testing', 'deployment'];
            phaseOrder.forEach(key => {
                if (phases[key]) {
                    const phase = phases[key];
                    const percentage = (phase.hours / totalHours * 100).toFixed(1);
                    const phaseDiv = document.createElement('div');
                    phaseDiv.className = 'phase-item';
                    phaseDiv.innerHTML = `
                        <div>
                            <div class="phase-name">${phase.name}</div>
                            <div class="phase-bar">
                                <div class="phase-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="phase-hours">${Math.round(phase.hours).toLocaleString()} hrs (${percentage}%)</div>
                    `;
                    phaseBreakdownDiv.appendChild(phaseDiv);
                }
            });

            // Add risk buffer display
            const bufferDiv = document.createElement('div');
            bufferDiv.className = 'phase-item';
            bufferDiv.style.background = '#fff3cd';
            bufferDiv.innerHTML = `
                <div>
                    <div class="phase-name">‚ö†Ô∏è Risk Buffer / Contingency</div>
                </div>
                <div class="phase-hours">${Math.round(bufferHours).toLocaleString()} hrs (${(riskBuffer * 100).toFixed(0)}%)</div>
            `;
            phaseBreakdownDiv.appendChild(bufferDiv);

            // Display team composition
            const teamCompositionDiv = document.getElementById('teamComposition');
            teamCompositionDiv.style.display = 'block';
            teamCompositionDiv.innerHTML = '<h3>Suggested Team Composition</h3>';

            const roles = calculateTeamComposition(teamSize, complexity);
            roles.forEach(role => {
                const roleDiv = document.createElement('div');
                roleDiv.className = 'role-item';
                const allocationText = role.allocation < 1.0 ? ` @ ${Math.round(role.allocation * 100)}%` : '';
                const fteDisplay = role.fte ? role.fte.toFixed(2) : role.count;
                roleDiv.innerHTML = `
                    <span><strong>${role.title}</strong></span>
                    <span>${fteDisplay} FTE${allocationText} (${role.percentage})</span>
                `;
                teamCompositionDiv.appendChild(roleDiv);
            });

            // Show export buttons
            document.getElementById('exportButtons').style.display = 'flex';

            // Store calculation data for export
            window.effortData = {
                projectName,
                inputs: {
                    numFeatures,
                    complexity,
                    avgStoryPoints,
                    totalStoryPoints,
                    teamVelocity,
                    sprintDuration: '2 weeks',
                    teamSize,
                    totalSprints: numSprints,
                    riskLevel: riskBuffer * 100 + '%',
                    riskBufferPercentage: riskBuffer * 100,
                    technologyStack: getTechStackName(techStack),
                    techMultiplier: tech.effortMultiplier,
                    includeDiscovery,
                    includeDeployment
                },
                results: {
                    totalHours: Math.round(totalHours),
                    totalDays: Math.round(totalDays),
                    totalWeeks: Math.round(totalWeeks),
                    totalMonths: parseFloat(totalMonths.toFixed(1)),
                    hoursPerFTE: Math.round(totalHours/teamSize)
                },
                phases: Object.entries(phases).map(([key, phase]) => ({
                    name: phase.name,
                    hours: Math.round(phase.hours),
                    percentage: (phase.hours / totalHours * 100).toFixed(1)
                })).concat([{
                    name: 'Risk Buffer',
                    hours: Math.round(bufferHours),
                    percentage: (riskBuffer * 100).toFixed(0)
                }]),
                teamComposition: roles
            };
        }

        function calculateTeamComposition(teamSize, complexity) {
            // Check if custom allocations are enabled
            const customAllocations = document.getElementById('customAllocations').checked;
            
            // Get custom allocation percentages
            const allocations = customAllocations ? {
                pm: parseInt(document.getElementById('pmAllocation').value) / 100,
                architect: parseInt(document.getElementById('architectAllocation').value) / 100,
                ml: parseInt(document.getElementById('mlAllocation').value) / 100,
                qa: parseInt(document.getElementById('qaAllocation').value) / 100,
                devops: parseInt(document.getElementById('devopsAllocation').value) / 100
            } : null;

            // Base percentages
            let roles = [];

            if (teamSize <= 3) {
                // Small team
                const architectCount = 1;
                const mlCount = Math.max(1, teamSize - 2);
                const qaDevopsCount = 1;

                roles = [
                    { title: 'Tech Lead / Architect', count: architectCount, fte: customAllocations ? architectCount * allocations.architect : architectCount, allocation: customAllocations ? allocations.architect : 1.0, percentage: '33%' },
                    { title: 'ML Engineers / Developers', count: mlCount, fte: customAllocations ? mlCount * allocations.ml : mlCount, allocation: customAllocations ? allocations.ml : 1.0, percentage: `${Math.round((teamSize-2)/teamSize*100)}%` },
                    { title: 'QA / DevOps', count: qaDevopsCount, fte: customAllocations ? qaDevopsCount * ((allocations.qa + allocations.devops) / 2) : qaDevopsCount, allocation: customAllocations ? (allocations.qa + allocations.devops) / 2 : 1.0, percentage: '33%' }
                ];
            } else if (teamSize <= 8) {
                // Medium team
                const mlEngineers = Math.ceil(teamSize * 0.5);
                const qaCount = Math.max(1, Math.floor(teamSize * 0.2 / 2));
                const devopsCount = Math.max(1, Math.ceil(teamSize * 0.2 / 2));
                const architect = 1;
                const pm = 1;
                
                roles = [
                    { title: 'Product Manager', count: pm, fte: customAllocations ? pm * allocations.pm : pm, allocation: customAllocations ? allocations.pm : 1.0, percentage: '12%' },
                    { title: 'Solution Architect', count: architect, fte: customAllocations ? architect * allocations.architect : architect, allocation: customAllocations ? allocations.architect : 1.0, percentage: '12%' },
                    { title: 'ML Engineers / Developers', count: mlEngineers, fte: customAllocations ? mlEngineers * allocations.ml : mlEngineers, allocation: customAllocations ? allocations.ml : 1.0, percentage: '50%' },
                    { title: 'QA Engineers', count: qaCount, fte: customAllocations ? qaCount * allocations.qa : qaCount, allocation: customAllocations ? allocations.qa : 1.0, percentage: '13%' },
                    { title: 'DevOps Engineer', count: devopsCount, fte: customAllocations ? devopsCount * allocations.devops : devopsCount, allocation: customAllocations ? allocations.devops : 1.0, percentage: '13%' }
                ];
            } else {
                // Large team
                const pmCount = 1;
                const architectCount = 1;
                const techLeadCount = 1;
                const mlCount = Math.ceil(teamSize * 0.4);
                const devCount = Math.ceil(teamSize * 0.2);
                const qaCount = Math.ceil(teamSize * 0.08);
                const devopsCount = Math.ceil(teamSize * 0.08);

                roles = [
                    { title: 'Product Manager', count: pmCount, fte: customAllocations ? pmCount * allocations.pm : pmCount, allocation: customAllocations ? allocations.pm : 1.0, percentage: '8%' },
                    { title: 'Solution Architect', count: architectCount, fte: customAllocations ? architectCount * allocations.architect : architectCount, allocation: customAllocations ? allocations.architect : 1.0, percentage: '8%' },
                    { title: 'Tech Lead', count: techLeadCount, fte: customAllocations ? techLeadCount * allocations.architect : techLeadCount, allocation: customAllocations ? allocations.architect : 1.0, percentage: '8%' },
                    { title: 'ML Engineers / Data Scientists', count: mlCount, fte: customAllocations ? mlCount * allocations.ml : mlCount, allocation: customAllocations ? allocations.ml : 1.0, percentage: '40%' },
                    { title: 'Software Engineers', count: devCount, fte: customAllocations ? devCount * allocations.ml : devCount, allocation: customAllocations ? allocations.ml : 1.0, percentage: '20%' },
                    { title: 'QA Engineers', count: qaCount, fte: customAllocations ? qaCount * allocations.qa : qaCount, allocation: customAllocations ? allocations.qa : 1.0, percentage: '8%' },
                    { title: 'DevOps Engineer', count: devopsCount, fte: customAllocations ? devopsCount * allocations.devops : devopsCount, allocation: customAllocations ? allocations.devops : 1.0, percentage: '8%' }
                ];
            }

            return roles;
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(window.effortData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `effort-estimate-${window.effortData.projectName.replace(/\s+/g, '-')}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            const data = window.effortData;
            const summary = `
EFFORT ESTIMATE: ${data.projectName}

INPUTS:
- Number of Features: ${data.inputs.numFeatures}
- Total Story Points: ${data.inputs.totalStoryPoints}
- Complexity: ${data.inputs.complexity}
- Avg Story Points per Feature: ${data.inputs.avgStoryPoints}
- Team Velocity: ${data.inputs.teamVelocity} points per sprint
- Sprint Duration: ${data.inputs.sprintDuration}
- Team Size: ${data.inputs.teamSize} FTE
- Risk Level: ${data.inputs.riskLevel}

RESULTS:
- Total Effort: ${data.results.totalHours.toLocaleString()} hours
- Timeline: ${data.results.totalMonths} months (${data.results.totalWeeks} weeks)
- Sprints Required: ${data.inputs.totalSprints}
- Effort per FTE: ${data.results.hoursPerFTE.toLocaleString()} hours

PHASE BREAKDOWN:
${data.phases.map(p => `- ${p.name}: ${p.hours.toLocaleString()} hrs (${p.percentage}%)`).join('\n')}

TEAM COMPOSITION:
${data.teamComposition.map(r => {
                const fte = r.fte || r.count;
                const allocationText = r.allocation && r.allocation < 1.0 ? ` @ ${Math.round(r.allocation * 100)}%` : '';
                return `- ${r.title}: ${typeof fte === 'number' ? fte.toFixed(2) : fte} FTE${allocationText} (${r.percentage})`;
            }).join('\n')}
            `.trim();

            navigator.clipboard.writeText(summary).then(() => {
                alert('‚úÖ Summary copied to clipboard!');
            });
        }
    </script>
</body>
</html>
