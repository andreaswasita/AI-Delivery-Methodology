{
  "name": "pol-deny-fa-slots-config-traffic-via-public-network",
  "properties": {
    "displayName": "Function app slots should route configuration traffic over the virtual network",
    "description": "Configuration routing affects operations that happen before or during startup of your app. Virtual network routing handles how both app and configuration traffic are routed from your virtual network and out.",
    "metadata": {
      "category": "Network Security",
      "version": "1.0.0",
      "preview": false,
      "deprecated": false
    },
    "mode": "Indexed",
    "parameters": {
      "effect": {
        "type": "string",
        "metadata": {
          "description": "'Audit' allows a non-compliant resource to be created, but flags it as non-compliant. 'Deny' blocks the resource creation. 'Disable' turns off the policy.",
          "displayName": "Effect"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.Web/sites/slots"
          },
          {
            "field": "kind",
            "contains": "functionapp"
          },
          {
            "field": "kind",
            "notContains": "workflowapp"
          },
          {
            "anyOf": [
              {
                "field": "Microsoft.Web/sites/slots/vnetImagePullEnabled",
                "notEquals": "true"
              },
              {
                "field": "Microsoft.Web/sites/slots/vnetContentShareEnabled",
                "notEquals": "true"
              }
            ]
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]"
      }
    }
  }
}
